<!DOCTYPE html>
<html lang="en">

<%- include('../partials/head/head.ejs') %>

    <body>

        <div class="screen-overlay"></div>
        <aside class="navbar-aside" id="offcanvas_aside">
            <div class="aside-top">
                <a href="index.html" class="brand-wrap">
                    <img src="assets/imgs/theme/logo.svg" class="logo" alt="BuzzBrews & Chills">
                </a>
                <div>
                    <button class="btn btn-icon btn-aside-minimize">
                        <i class="text-muted material-icons md-menu_open"></i>
                    </button>
                </div>
            </div>
            <nav>
                <div class="menu-aside">

                    <a class="menu-link" href="/admin/dashboard">
                        <i class="icon material-icons md-home"></i>
                        <span class="text">Dashboard</span>
                    </a>
                    <div class="menu-item active">
                        <a class="menu-link" href="/admin/products">
                            <i class="icon material-icons md-shopping_bag"></i>
                            <span class="text">Products</span>
                        </a>
                    </div>
                    <div class="menu-item ">
                        <a class="menu-link" href="/admin/category">
                            <i class="icon material-icons md-shopping_bag"></i>
                            <span class="text">categories</span>
                        </a>
                    </div>
                    <div class="menu-item">
                        <a class="menu-link" href="/admin/orders">
                            <i class="icon material-icons md-shopping_cart"></i>
                            <span class="text">Orders</span>
                        </a>
                    </div>
                    <div class="menu-item">
                        <a class="menu-link" href="/admin/users-list">
                            <i class="icon material-icons md-person"></i>
                            <span class="text">Users</span>
                        </a>
                    </div>
                    <div class="menu-item">
                        <a class="menu-link" href="/admin/add-new-products">
                            <i class="icon material-icons md-add_box"></i>
                            <span class="text">Add product</span>
                        </a>
                    </div>
                    <li class="menu-item">
                        <a class="menu-link" href="/admin/transaction">
                            <i class="icon material-icons md-monetization_on"></i>
                            <span class="text">Transactions</span>
                        </a>
                    </li>
                    <div class="menu-item">
                        <a class="menu-link" href="/">
                            <i class="icon material-icons md-person"></i>
                            <span class="text">User Login</span>
                        </a>
                    </div>
                    <div class="menu-item">
                        <a class="menu-link" href="/admin/coupon">
                            <i class="icon material-icons md-comment"></i>
                            <span class="text">Coupon</span>
                        </a>
                    </div>
                    <div class="menu-item">
                        <a class="menu-link" href="/admin/brands">
                            <i class="icon material-icons md-stars"></i>
                            <span class="text">Brands</span>
                        </a>
                    </div>
                </div>
                <hr>
                <br>
                <br>
            </nav>
        </aside>


        <main class="main-wrap">

            <%- include('../partials/header/header.ejs') %>

                <section class="content-main">
                    <div class="content-header">
                        <div>
                            <h2 class="content-title card-title">Products List</h2>
                            <p>Lorem ipsum dolor sit amet.</p>
                        </div>
                        <div>
                            <a href="#" class="btn btn-light rounded font-md">Export</a>
                            <a href="#" class="btn btn-light rounded  font-md">Import</a>
                            <a href="/admin/add-new-products" class="btn btn-primary btn-sm rounded">Create new</a>
                        </div>
                    </div>
                    <div class="card mb-4">
                        <header class="card-header">
                            <div class="row align-items-center">
                                <div class="col col-check flex-grow-0">
                                    <div class="form-check ms-2">
                                        <input class="form-check-input" type="checkbox" value="">
                                    </div>
                                </div>
                                <div class="col-md-3 col-12 me-auto mb-md-0 mb-3">
                                    <select class="form-select">
                                        <option selected>All category</option>
                                        <option>Electronics</option>
                                        <option>Clothes</option>
                                        <option>Automobile</option>
                                    </select>
                                </div>
                                <div class="col-md-2 col-6">
                                    <input type="date" value="02.05.2021" class="form-control">
                                </div>
                                <div class="col-md-2 col-6">
                                    <select class="form-select">
                                        <option selected>Status</option>
                                        <option>Active</option>
                                        <option>Disabled</option>
                                        <option>Show all</option>
                                    </select>
                                </div>
                            </div>
                        </header>
                        <!-- card-header end// -->
                        <div class="card-body">
                            <% console.log('hello'); %>
                                <% if (product.length) { %>
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th scope="col">
                                                    <input type="checkbox">
                                                </th>
                                                <th scope="col" class="fs-4 fw-bold">Name</th>
                                                <th scope="col" class="fs-4 fw-bold">Image</th>
                                                <th scope="col" class="fs-4 fw-bold">Price</th>
                                                <th scope="col" class="fs-4 fw-bold">Stock</th>
                                                <th scope="col" class="fs-4 fw-bold">Category</th>
                                                <th scope="col" class="fs-4 fw-bold">Discount</th>
                                                <th scope="col" class="fs-4 fw-bold">Status</th>
                                                <th scope="col" class="fs-4 fw-bold">Date</th>
                                                <th scope="col" class="fs-4 fw-bold">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% for (let i=0; i < product.length; i++) { %>
                                                <tr>
                                                    <td>
                                                        <input type="checkbox">
                                                    </td>
                                                    <td>
                                                            <div class="info">
                                                                <h6 class="mb-0 fw-bolder">
                                                                    <%= product[i].name %>
                                                                </h6>
                                                            </div>
                                                    </td>
                                                    <td class="align-middle">

                                                        <img src="/product-images/<%= product[i].imageUrl[0] %>"
                                                            class="img-sm img-thumbnail" alt="Item">
                                                    </td>
                                                    <td>
                                                        <h6 class="fw-bolder text-dark">â‚¹ <%= product[i].price %></h6>
                                                    </td>
                                                    <td>
                                                        <h6 class="fw-bolder">
                                                            <% if ( product[i].stock===0 ) { %>
                                                                <span class="text-danger">Product is out of stock</span>
                                                                <% }else {%>
                                                                    <%= product[i].stock %>
                                                                        <% } %>
                                                        </h6>
                                                    </td>
                                                    <td>
                                                        <h6 class="fw-bolder">
                                                            <%= product[i].category.name %>
                                                        </h6>
                                                    </td>
                                                    <td>
                                                        <h6>
                                                            <% if (product[i].discount) { %>
                                                                <%= product[i].discount %>%
                                                                    <% }else {%>
                                                                        No discount applied yet
                                                                        <% } %>
                                                        </h6>
                                                    </td>
                                                    <td>
                                                        <% if (product[i].availability==='ACTIVE' ) { %>

                                                            <span class="badge rounded-pill alert-success fw-bold fs-6">
                                                                <%= product[i].availability %>
                                                            </span>
                                                            <% } else {%>
                                                                <span class="badge rounded-pill alert-danger fw-bold fs-6">
                                                                    <%= product[i].availability %>
                                                                </span>
                                                                <% } %>
                                                    </td>
                                                    <td>
                                                        <span class="fw-bold fs-6">
                                                            <%= new
                                                                Date(product[i].createdAt).toLocaleDateString('en-GB')
                                                                %>
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <a href="/admin/edit-products/<%= product[i]._id %>"
                                                            class="btn btn-sm font-sm rounded btn-brand m-3">
                                                            <i class="material-icons md-edit"></i>
                                                            Edit
                                                        </a>

                                                        <button
                                                            onclick="hideAndUnhide('<%= product[i]._id %>','<%= product[i].availability %>')"
                                                            class="btn btn-sm font-sm btn-light rounded"
                                                            id="productButton_<%= product[i]._id %>"
                                                            style="width: 6rem;">
                                                            <% if(product[i].availability==='ACTIVE' ) {%>
                                                                HIDE
                                                                <% } else { %>
                                                                    SHOW
                                                                    <% } %>
                                                                        <i class="material-icons md-delete_forever"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                                </td>
                                        </tbody>
                                        </tr>
                                        <% } %>
                                            </tbody>
                                    </table>
                                    <% } %>
                        </div>


                        <!-- card-body end// -->
    </body>

</html>
</div><!-- card end// -->
<div class="pagination-area mt-30 mb-50">
    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-start">
            <% if (page> 1) { %>
                <li class="page-item">
                    <a class="page-link" href="/admin/products/?page=<%= page - 1 %>">Prev</a>
                </li>
                <% } %>
                    <% for (let i=1; i <=totalPages; i++) { %>
                        <li class="page-item <%= page === i ? 'active' : '' %>">
                            <a class="page-link" href="/admin/products/?page=<%= i %>">
                                <%= i %>
                            </a>
                        </li>
                        <% } %>
                            <% if (page < totalPages) { %>
                                <li class="page-item">
                                    <a class="page-link btn btn-primary"
                                        href="/admin/products/?page=<%= page + 1 %>">Next</a>
                                </li>
                                <% } %>
        </ul>
    </nav>
</div><%- include('../partials/footer/footer.ejs') %>
    <script>
        async function hideAndUnhide(id, availability) {
            console.log(id, availability)
            const response = await fetch(`/admin/manage-products/${id}?availability=${availability}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            })

                .then(response => {
                    console.log(response, 'response recieved');

                    if (!response.ok) {
                        throw err('error occured')
                    }
                    return response.json()
                }).then(data => {
                    console.log(data, 'data is recieving or not');
                    if (data.id) {
                        window.location.reload()
                        console.log('fetched successfull');
                    } else {
                        console.error('fetched unsuccessfull', data.error);
                    }
                })
        }

    </script>
    </body>

    </html>